<template>
    <div class="container">
      <div v-if="!iframeUrl">
        <svg t="1718893651205" style="display: block;" class="icon" viewBox="0 0 4580 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="8434" width="150" height="150"><path d="M1436.392727 162.909091c-16.756364-62.370909-66.094545-111.709091-128.465454-128.465455C1195.287273 3.723636 741.934545 3.723636 741.934545 3.723636S288.581818 4.654545 175.941818 35.374545c-62.370909 16.756364-111.709091 66.094545-128.465454 128.465455C17.687273 276.48 17.687273 512 17.687273 512s0 235.52 30.72 349.090909c16.756364 62.370909 66.094545 111.709091 128.465454 128.465455 112.64 30.72 565.992727 30.72 565.992728 30.72s453.352727 0 565.992727-30.72c62.370909-16.756364 111.709091-66.094545 128.465454-128.465455 30.72-112.64 30.72-349.090909 30.72-349.090909s-0.930909-235.52-31.650909-349.090909z" fill="#FF0000" p-id="8435"></path><path d="M597.643636 729.832727L973.730909 512 597.643636 294.167273z" fill="#FFFFFF" p-id="8436"></path><path d="M2121.541818 928.116364c-28.858182-19.549091-49.338182-49.338182-61.44-90.298182-12.101818-40.96-17.687273-94.952727-17.687273-162.909091v-92.16c0-67.956364 6.516364-123.810909 20.48-164.770909 13.963636-41.890909 35.374545-71.68 65.163637-90.298182 29.789091-18.618182 67.956364-28.858182 115.432727-28.858182 46.545455 0 84.712727 9.309091 112.64 28.858182s49.338182 49.338182 62.370909 90.298182c13.032727 40.96 19.549091 95.883636 19.549091 163.84v92.16c0 67.956364-6.516364 121.949091-19.549091 162.909091-13.032727 40.96-33.512727 70.749091-62.370909 90.298182-28.858182 18.618182-67.956364 28.858182-116.363636 28.858181-50.269091 0.930909-89.367273-9.309091-118.225455-27.927272zM2282.589091 828.509091c8.378182-20.48 12.101818-54.923636 12.101818-101.469091V528.756364c0-45.614545-3.723636-79.127273-12.101818-99.607273-8.378182-21.410909-22.341818-31.650909-41.890909-31.650909s-32.581818 10.24-40.96 31.650909c-8.378182 21.410909-12.101818 53.992727-12.101818 99.607273v198.283636c0 46.545455 3.723636 80.989091 11.170909 101.469091 7.447273 20.48 21.410909 30.72 41.890909 30.72 19.549091 0 33.512727-10.24 41.890909-30.72zM4323.141818 676.770909v32.581818c0 40.96 0.930909 71.68 3.723637 92.16 2.792727 20.48 7.447273 35.374545 14.894545 44.683637s19.549091 13.963636 35.374545 13.963636c21.410909 0 36.305455-8.378182 43.752728-25.134545 8.378182-16.756364 12.101818-44.683636 13.032727-82.85091l123.810909 7.447273c0.930909 5.585455 0.930909 13.032727 0.930909 22.341818 0 58.647273-15.825455 102.4-48.407273 131.258182-32.581818 28.858182-77.265455 43.752727-135.912727 43.752727-70.749091 0-120.087273-22.341818-148.014545-66.094545-27.927273-43.752727-42.821818-112.64-42.821818-204.8V573.44c0-94.952727 14.894545-164.770909 43.752727-208.523636 29.789091-43.752727 80.058182-66.094545 150.807273-66.094546 49.338182 0 86.574545 9.309091 112.64 26.996364 26.065455 17.687273 44.683636 45.614545 55.854545 83.781818 11.170909 38.167273 15.825455 90.298182 15.825455 157.323636v108.916364h-239.243637z m18.618182-268.101818c-7.447273 9.309091-12.101818 23.272727-14.894545 43.752727-2.792727 20.48-3.723636 51.2-3.723637 93.090909v45.614546h104.261818v-45.614546c0-40.96-0.930909-71.68-3.723636-93.090909-2.792727-21.410909-7.447273-36.305455-14.894545-44.683636-7.447273-8.378182-18.618182-13.032727-33.512728-13.032727-15.825455 0.930909-26.996364 5.585455-33.512727 13.963636zM1773.381818 664.669091L1610.472727 76.334545h142.429091l56.785455 266.24c14.894545 66.094545 25.134545 121.949091 32.581818 167.563637h3.723636c4.654545-33.512727 15.825455-88.436364 32.581818-166.632727l58.647273-267.17091h142.429091l-164.770909 587.403637v282.065454h-140.567273V664.669091zM2899.781818 310.923636v635.810909h-111.709091l-12.101818-78.196363h-2.792727c-30.72 58.647273-76.334545 88.436364-136.843637 88.436363-41.890909 0-73.541818-13.963636-93.090909-41.890909-20.48-27.927273-29.789091-70.749091-29.789091-129.396363v-474.763637h143.36v466.385455c0 27.927273 2.792727 48.407273 9.309091 60.509091 6.516364 12.101818 16.756364 17.687273 30.72 17.687273 12.101818 0 24.203636-3.723636 35.374546-11.17091 11.170909-7.447273 19.549091-17.687273 25.134545-28.858181V310.923636h142.429091zM3634.269091 310.923636v635.810909h-111.709091l-12.101818-78.196363h-2.792727c-30.72 58.647273-76.334545 88.436364-136.843637 88.436363-41.890909 0-73.541818-13.963636-93.090909-41.890909-20.48-27.927273-29.789091-70.749091-29.789091-129.396363v-474.763637h143.36v466.385455c0 27.927273 2.792727 48.407273 9.309091 60.509091 6.516364 12.101818 16.756364 17.687273 30.72 17.687273 12.101818 0 24.203636-3.723636 35.374546-11.17091 11.170909-7.447273 19.549091-17.687273 25.134545-28.858181V310.923636h142.429091z" fill="#282828" p-id="8437"></path><path d="M3288.901818 191.767273H3146.472727v754.967272h-139.636363V191.767273h-142.429091V76.334545h423.563636v115.432728zM4107.170909 412.392727c-8.378182-40.029091-22.341818-68.887273-41.890909-87.505454-19.549091-17.687273-45.614545-26.996364-80.058182-26.996364-26.065455 0-51.2 7.447273-73.541818 22.341818-23.272727 14.894545-40.029091 34.443636-53.061818 58.647273h-0.930909v-335.127273h-137.774546v902.050909h118.225455l14.894545-60.509091h2.792728c11.170909 21.410909 27.927273 38.167273 49.338181 51.2 22.341818 12.101818 46.545455 18.618182 73.541819 18.618182 48.407273 0 83.781818-22.341818 107.054545-67.025454 22.341818-44.683636 34.443636-114.501818 34.443636-208.523637V579.025455c0-70.749091-4.654545-126.603636-13.032727-166.632728z m-131.258182 259.723637c0 46.545455-1.861818 82.850909-5.585454 108.916363-3.723636 26.065455-10.24 44.683636-19.549091 55.854546-9.309091 11.170909-21.410909 16.756364-36.305455 16.756363-12.101818 0-22.341818-2.792727-32.581818-8.378181-10.24-5.585455-17.687273-13.963636-24.203636-25.134546V458.938182c4.654545-17.687273 13.032727-31.650909 25.134545-42.821818 12.101818-11.170909 24.203636-16.756364 38.167273-16.756364 14.894545 0 26.065455 5.585455 33.512727 16.756364 8.378182 11.170909 13.032727 30.72 16.756364 57.716363 2.792727 26.996364 4.654545 65.163636 4.654545 115.432728v82.850909z" fill="#282828" p-id="8438"></path></svg> 
        <input class="inp" type="text" v-model="youtubeLink" placeholder="Please input YouTube link" />
        <div class="btn" @click="extractId">Send</div>
      </div>
      <iframe
        v-else
        id="youtubeIf"
        :src="iframeUrl"
        frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; fullscreen"
        allowfullscreen="allowfullscreen"
        mozallowfullscreen="mozallowfullscreen"
        msallowfullscreen="msallowfullscreen"
        oallowfullscreen="oallowfullscreen"
        webkitallowfullscreen="webkitallowfullscreen">
      </iframe>
      <div class="recommend" v-if="!iframeUrl">
        <div class="list">From puppy to old dog (0-100 Dog Years)<button @click="sed('https://www.youtube.com/watch?v=Y3Rt5S-HKOY')">select</button></div>
      </div>
    </div>
  </template>
  
  <script lang="ts" setup>
  import { ref, computed, onMounted } from 'vue';
  import { useRoute } from 'vue-router'
  import { showDiaLog } from "@/utils";
  import { DIALOG_TYPE } from "@/enum";
  
  const route = useRoute();
  
  const youtubeLink = ref('');
  const iframeUrl = ref('');
  const id = ref('');
  
  function EmbededAdd(id) {
    return `https://www.youtube.com/embed/${id}?autoplay=1&mute=1&controls=0`;
  };

  function sed(url) {
    youtubeLink.value = url;
    extractId()
  }

  onMounted(() => {
    const youtubeParam = route.query;
    console.log('---youtubeParam--', youtubeParam)
    if (youtubeParam.youtube) {
        iframeUrl.value = EmbededAdd(youtubeParam.youtube);
    }
  });
  
  function extractId() {
    const match = youtubeLink.value.match(/(?:https?:\/\/)?(?:www\.)?youtube\.com\/watch\?v=([^&]+).*/);
    if (match && match[1]) {
    //   id.value = match[1];
      (window as any).socket.emit('share_video', {
        "roomId": (window as any).roomId.value,
        "user": (window as any).userName,
        "youtube": match[1]
        });
        showDiaLog({ type: DIALOG_TYPE.SUCCESS, msg: `send success!` });
    } else {
      alert("Please enter a valid YouTube link");
    }
  }
  
  </script>
  
  <style lang="less" scoped>
  .container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
  }
  #youtubeIf {
    width: 100vw;
    height: 100vh;
  }
  .inp {
      border: 1px solid rgb(162, 175, 185);
      border-radius: 10px;
      width: 60vw;
      height: 6vh;
      position: static;
      padding: 4px 20px;
    }
    .btn {
      width: 70vw;
        height: 5vh;
        line-height: 5vh;
        color: #fff;
        background: #ea4c89;
        border-radius: 10px;
        margin: 10px auto 30px;
        text-align: center;
    }
    .recommend {
        width: 70vw;
        .list{
            width: 80%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            position: relative;
            padding-right: 60px;
            button{
                height:22px;
                background: #ea4c89;
                border-radius: 10px;
                color: #fff;
                position: absolute;
                right: 0;
                border: none;
            }
        }
    }
  </style>
  